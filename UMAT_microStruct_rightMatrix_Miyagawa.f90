!*************************************************************************!
!
!                    DEFINITION SUBROUTINE UMAT
!
! Cure and temperature dependent viscoelastic model 
! MATERIALS: %
! COMPOSITE RELAXATION TIMES: 14
!
! IMPLEMENTATION METHOD: Backward Euler
!
! Last Modification: Anton Trofimov 4/01/2019
! Generated by MATLAB file: UMATgeneration_AT 
!*************************************************************************!
!
      SUBROUTINE UMAT_microStruct_rightMatrix_Miyagawa(STRESS,STATEV,DDSDDE,SSE,SPD,SCD,&
      RPL,DDSDDT,DRPLDE,DRPLDT,&
      STRAN,DSTRAN,TIME,DTIME,TEMP,DTEMP,PREDEF,DPRED,CMNAME,&
      NDI,NSHR,NTENS,NSTATV,PROPS,NPROPS,COORDS,DROT,PNEWDT,&
      CELENT,DFGRD0,DFGRD1,NOEL,NPT,LAYER,KSPT,KSTEP,KINC)
!
      IMPLICIT NONE
!
      CHARACTER*80 CMNAME
!
      INTEGER :: i,j,i_x,i_y
!
      INTEGER*8 :: NDI, NSHR, NTENS, NSTATV, NPROPS,&
             NOEL, NPT, LAYER, KSPT, KSTEP, KINC
!
      REAL*8 :: STRESS(NTENS), STATEV(NSTATV),&
             DDSDDE(NTENS,NTENS),&
             SSE, SPD, SCD,&
             RPL, DDSDDT(NTENS), DRPLDE(NTENS), DRPLDT,&
             STRAN(NTENS), DSTRAN(NTENS),&
             TIME(2), DTIME,&
             TEMP, DTEMP, PREDEF(*), DPRED(*),&
             PROPS(NPROPS),&
             COORDS(3),&
             DROT(3,3),&
             PNEWDT,&
             CELENT,&
             DFGRD0(3,3), DFGRD1(3,3)
!
!*******************PROPERTIES DEFINITION*********************************!
!
      REAL*8 :: alpha ! DoC and DoC increment (if we have a link with heat transfer analysis)	
!
! DiBenedetto Model
!
      REAL*8 :: Tg_inf = 156.28000d+0  ![C] Fully cured glass transition Temp
      REAL*8 :: Tg_0 = 11.70000d+0  ![C] Monomer glass transition Temp
      REAL*8 :: lambda = 0.40230d+0  ! DiBenedetto equation constant
      REAL*8 :: Tg  ! DiBenedetto glass transition temperature
!
! Arrhenius Shift Factor model
!
      REAL*8 :: H1_a = 14.81178d+0  ! [J/mol]
      REAL*8 :: H2_a = 14.81178d+0  ! [J/mol]
      REAL*8 :: H1_b = 33.79909d+0  ![J/mol]
      REAL*8 :: H2_b = 33.79909d+0  ![J/mol]
      REAL*8 :: E_a  ! [J/mol]- Activation energy shift factor below Tg
      REAL*8 :: E_a2  ! [J/mol]- Activation energy shift factor above Tg
      REAL*8 :: R = 0.00831d+0  ! [J/K.mmol]- Universal gas constant
      REAL*8 :: ln10 = 2.30259d+0
      REAL*8 :: aT,h ! Shift Factor and time step
      REAL, DIMENSION (NTENS,NTENS) :: K1,K2,p_alpha ! matrices to calculate p_alpha !
! Viscoelastic model
!
      INTEGER*8 :: PRONY = 14 ! Number of prony series
      REAL,DIMENSION(14):: tau !  Composite relaxation times
!
! For Euler method
!
      REAL*8 :: A  ! inverse aT
      INTEGER :: L_B, R_B ! for p_alpha.*L2 calculation
      REAL, DIMENSION (NTENS,NTENS) :: C_inf, C_sum, L1,LL, LL1 ! C_sum is used for L1 calc 
      REAL, DIMENSION (NTENS*14) :: vector_diag, W1_1 ! vector diag is used to calculate L3
      REAL, DIMENSION (NTENS,NTENS*14) :: L2, L2_alpha ! see Euler scheme
      REAL, DIMENSION (NTENS*14,NTENS) :: L2_alpha_t,L2_t ! [Pa] 
      REAL, DIMENSION (NTENS*14,NTENS*14) :: W1 ! see Euler scheme
      REAL, DIMENSION (NTENS*14,NTENS) :: W2 ! see Euler scheme
      REAL, DIMENSION (NTENS,NTENS*14) :: M2 ! see Euler scheme
      REAL, DIMENSION (NTENS*14) :: chi, chi_n ! Hidden internal variables defined

! DoC recovery from a previous simulation (if linked with heat analysis)

      alpha=1.0d0! if you couple with UEXPAN change it to alpha = statev(NSTATV)

! Relaxation time- 1 per decade 

      tau(1) = 1d-9
      tau(2) = 1d-8
      tau(3) = 1d-7
      tau(4) = 1d-6
      tau(5) = 1d-5
      tau(6) = 1d-4
      tau(7) = 1d-3
      tau(8) = 1d-2
      tau(9) = 1d-1
      tau(10) = 1d0
      tau(11) = 1d1
      tau(12) = 1d2
      tau(13) = 1d3
      tau(14) = 1d4

      !DoC and Temperature dependence (aT and palpha)
      !	DiBenedetto Model
      Tg = lambda*alpha*(Tg_inf-Tg_0)/(1-(1-lambda)*alpha)+Tg_0 ! [Cï¿½]

      !	Arrhenius Shift factor Model
      IF (Temp.GE.Tg) THEN
         E_a2 = H2_a*alpha+H2_b
         aT=10**(E_a2*(1/(Temp+273.15d0)-1/(Tg+273.15d0))/(R*ln10))
      ELSE
         E_a= H1_a*alpha+H1_b
         aT=10**(E_a*(1/(Temp+273.15d0)-1/(Tg+273.15d0))/(R*ln10))
      ENDIF

      !	P(alpha) Model

      ! K1 and K2 to construct p_alpha
      DO i=1,NTENS
         DO j=1,NTENS
              K1(i,j)=0.D0
              K2(i,j)=0.D0
         ENDDO
      ENDDO

      !	Definition of MATRIX material parameters

      !	Definition of Composite material parameters. X1 - must be the axis of anisotropy

      !
      K1(1,1) = 0.6856
      K1(1,2) = 0.7339
      K1(1,3) = 0.3781
      K1(1,4) = 0.0000
      K1(1,5) = 0.0000
      K1(1,6) = 0.0000
      !
      K1(2,1) = 0.7339
      K1(2,2) = 0.7943
      K1(2,3) = 0.9266
      K1(2,4) = 0.0000
      K1(2,5) = 0.0000
      K1(2,6) = 0.0000
      !
      K1(3,1) = 0.3781
      K1(3,2) = 0.9266
      K1(3,3) = 0.9913
      K1(3,4) = 0.0000
      K1(3,5) = 1.1406
      K1(3,6) = 0.0000
      !
      K1(4,1) = 0.0000
      K1(4,2) = 0.0000
      K1(4,3) = 0.0000
      K1(4,4) = 1.2372
      K1(4,5) = 0.0000
      K1(4,6) = 0.0000
      !
      K1(5,1) = 0.0000
      K1(5,2) = 0.0000
      K1(5,3) = 1.1406
      K1(5,4) = 0.0000
      K1(5,5) = 0.7631
      K1(5,6) = 0.0000
      !
      K1(6,1) = 0.0000
      K1(6,2) = 0.0000
      K1(6,3) = 0.0000
      K1(6,4) = 0.0000
      K1(6,5) = 0.0000
      K1(6,6) = 0.7631
      !
      K2(1,1) = 0.3632
      K2(1,2) = -0.4580
      K2(1,3) = -0.0147
      K2(1,4) = 0.0000
      K2(1,5) = 0.0000
      K2(1,6) = 0.0000
      !
      K2(2,1) = -0.4580
      K2(2,2) = 0.4918
      K2(2,3) = -0.7135
      K2(2,4) = 0.0000
      K2(2,5) = 0.0000
      K2(2,6) = 0.0000
      !
      K2(3,1) = -0.0147
      K2(3,2) = -0.7135
      K2(3,3) = 0.1363
      K2(3,4) = 0.0000
      K2(3,5) = -0.3160
      K2(3,6) = 0.0000
      !
      K2(4,1) = 0.0000
      K2(4,2) = 0.0000
      K2(4,3) = 0.0000
      K2(4,4) = -0.1377
      K2(4,5) = 0.0000
      K2(4,6) = 0.0000
      !
      K2(5,1) = 0.0000
      K2(5,2) = 0.0000
      K2(5,3) = -0.3160
      K2(5,4) = 0.0000
      K2(5,5) = 0.2999
      K2(5,6) = 0.0000
      !
      K2(6,1) = 0.0000
      K2(6,2) = 0.0000
      K2(6,3) = 0.0000
      K2(6,4) = 0.0000
      K2(6,5) = 0.0000
      K2(6,6) = 0.2999
      !
      !
      ! Non DOC of cure dependant parts (for L1 computation) are imported from Matlab

      !
      C_inf(1,1) = 7762.3606
      C_inf(1,2) = 4104.1093
      C_inf(1,3) = 4197.3226
      C_inf(1,4) = 0.0000
      C_inf(1,5) = 0.0000
      C_inf(1,6) = 0.0000
      !
      C_inf(2,1) = 4104.1093
      C_inf(2,2) = 7882.1554
      C_inf(2,3) = 4321.4170
      C_inf(2,4) = 0.0000
      C_inf(2,5) = 0.0000
      C_inf(2,6) = 0.0000
      !
      C_inf(3,1) = 4197.3226
      C_inf(3,2) = 4321.4170
      C_inf(3,3) = 25088.5064
      C_inf(3,4) = 0.0000
      C_inf(3,5) = 209.2403
      C_inf(3,6) = 0.0000
      !
      C_inf(4,1) = 0.0000
      C_inf(4,2) = 0.0000
      C_inf(4,3) = 0.0000
      C_inf(4,4) = 1702.2713
      C_inf(4,5) = 0.0000
      C_inf(4,6) = 0.0000
      !
      C_inf(5,1) = 0.0000
      C_inf(5,2) = 0.0000
      C_inf(5,3) = 209.2403
      C_inf(5,4) = 0.0000
      C_inf(5,5) = 2284.5711
      C_inf(5,6) = 0.0000
      !
      C_inf(6,1) = 0.0000
      C_inf(6,2) = 0.0000
      C_inf(6,3) = 0.0000
      C_inf(6,4) = 0.0000
      C_inf(6,5) = 0.0000
      C_inf(6,6) = 2284.5711
      !
      C_sum(1,1) = 21334.1886
      C_sum(1,2) = 7584.6963
      C_sum(1,3) = 4214.4757
      C_sum(1,4) = 0.0000
      C_sum(1,5) = 0.0000
      C_sum(1,6) = 0.0000
      !
      C_sum(2,1) = 7584.6963
      C_sum(2,2) = 18662.1924
      C_sum(2,3) = 5656.7509
      C_sum(2,4) = 0.0000
      C_sum(2,5) = 0.0000
      C_sum(2,6) = 0.0000
      !
      C_sum(3,1) = 4214.4757
      C_sum(3,2) = 5656.7509
      C_sum(3,3) = 43122.6743
      C_sum(3,4) = 0.0000
      C_sum(3,5) = 160.5964
      C_sum(3,6) = 0.0000
      !
      C_sum(4,1) = 0.0000
      C_sum(4,2) = 0.0000
      C_sum(4,3) = 0.0000
      C_sum(4,4) = 4736.8367
      C_sum(4,5) = 0.0000
      C_sum(4,6) = 0.0000
      !
      C_sum(5,1) = 0.0000
      C_sum(5,2) = 0.0000
      C_sum(5,3) = 160.5964
      C_sum(5,4) = 0.0000
      C_sum(5,5) = 7732.1612
      C_sum(5,6) = 0.0000
      !
      C_sum(6,1) = 0.0000
      C_sum(6,2) = 0.0000
      C_sum(6,3) = 0.0000
      C_sum(6,4) = 0.0000
      C_sum(6,5) = 0.0000
      C_sum(6,6) = 7730.2280
      !
      !  L2 Computation - Computed in Matlab to reduce computation time
      !
      !
      L2(1,1) = 2137219.4380
      L2(2,1) = 670638.1052
      L2(3,1) = 186752.0619
      L2(4,1) = 0.0000
      L2(5,1) = 0.0000
      L2(6,1) = 0.0000
      !
      L2(1,2) = 0.0000
      L2(2,2) = 1537961.5931
      L2(3,2) = 330882.1019
      L2(4,2) = 0.0000
      L2(5,2) = 0.0000
      L2(6,2) = 0.0000
      !
      L2(1,3) = 0.0000
      L2(2,3) = 0.0000
      L2(3,3) = 882392.3445
      L2(4,3) = 0.0000
      L2(5,3) = 9200.7648
      L2(6,3) = 0.0000
      !
      L2(1,4) = 0.0000
      L2(2,4) = 0.0000
      L2(3,4) = 0.0000
      L2(4,4) = 696471.6915
      L2(5,4) = 0.0000
      L2(6,4) = 0.0000
      !
      L2(1,5) = 0.0000
      L2(2,5) = 0.0000
      L2(3,5) = 0.0000
      L2(4,5) = 0.0000
      L2(5,5) = 2129949.9234
      L2(6,5) = 0.0000
      !
      L2(1,6) = 0.0000
      L2(2,6) = 0.0000
      L2(3,6) = 0.0000
      L2(4,6) = 0.0000
      L2(5,6) = 0.0000
      L2(6,6) = 2129949.9234
      !
      L2(1,7) = 333656.2607
      L2(2,7) = 132324.2670
      L2(3,7) = 39555.8863
      L2(4,7) = 0.0000
      L2(5,7) = 0.0000
      L2(6,7) = 0.0000
      !
      L2(1,8) = 0.0000
      L2(2,8) = 385020.6292
      L2(3,8) = 134179.2580
      L2(4,8) = 0.0000
      L2(5,8) = 0.0000
      L2(6,8) = 0.0000
      !
      L2(1,9) = 0.0000
      L2(2,9) = 0.0000
      L2(3,9) = 626226.9145
      L2(4,9) = 0.0000
      L2(5,9) = 2482.1669
      L2(6,9) = 0.0000
      !
      L2(1,10) = 0.0000
      L2(2,10) = 0.0000
      L2(3,10) = 0.0000
      L2(4,10) = 109312.7536
      L2(5,10) = 0.0000
      L2(6,10) = 0.0000
      !
      L2(1,11) = 0.0000
      L2(2,11) = 0.0000
      L2(3,11) = 0.0000
      L2(4,11) = 0.0000
      L2(5,11) = 76534.9833
      L2(6,11) = 0.0000
      !
      L2(1,12) = 0.0000
      L2(2,12) = 0.0000
      L2(3,12) = 0.0000
      L2(4,12) = 0.0000
      L2(5,12) = 0.0000
      L2(6,12) = 76534.9833
      !
      L2(1,13) = 148437.7402
      L2(2,13) = 58270.4716
      L2(3,13) = 35889.4122
      L2(4,13) = 0.0000
      L2(5,13) = 0.0000
      L2(6,13) = 0.0000
      !
      L2(1,14) = 0.0000
      L2(2,14) = 212351.8097
      L2(3,14) = 32540.0536
      L2(4,14) = 0.0000
      L2(5,14) = 0.0000
      L2(6,14) = 0.0000
      !
      L2(1,15) = 0.0000
      L2(2,15) = 0.0000
      L2(3,15) = 199066.0256
      L2(4,15) = 0.0000
      L2(5,15) = 1022.1036
      L2(6,15) = 0.0000
      !
      L2(1,16) = 0.0000
      L2(2,16) = 0.0000
      L2(3,16) = 0.0000
      L2(4,16) = 97455.1328
      L2(5,16) = 0.0000
      L2(6,16) = 0.0000
      !
      L2(1,17) = 0.0000
      L2(2,17) = 0.0000
      L2(3,17) = 0.0000
      L2(4,17) = 0.0000
      L2(5,17) = 39343.6086
      L2(6,17) = 0.0000
      !
      L2(1,18) = 0.0000
      L2(2,18) = 0.0000
      L2(3,18) = 0.0000
      L2(4,18) = 0.0000
      L2(5,18) = 0.0000
      L2(6,18) = 39343.6086
      !
      L2(1,19) = 58940.1445
      L2(2,19) = 19248.5580
      L2(3,19) = 7972.5161
      L2(4,19) = 0.0000
      L2(5,19) = 0.0000
      L2(6,19) = 0.0000
      !
      L2(1,20) = 0.0000
      L2(2,20) = 24038.5227
      L2(3,20) = 12458.5960
      L2(4,20) = 0.0000
      L2(5,20) = 0.0000
      L2(6,20) = 0.0000
      !
      L2(1,21) = 0.0000
      L2(2,21) = 0.0000
      L2(3,21) = 31317.7486
      L2(4,21) = 0.0000
      L2(5,21) = 637.0715
      L2(6,21) = 0.0000
      !
      L2(1,22) = 0.0000
      L2(2,22) = 0.0000
      L2(3,22) = 0.0000
      L2(4,22) = 27438.4465
      L2(5,22) = 0.0000
      L2(6,22) = 0.0000
      !
      L2(1,23) = 0.0000
      L2(2,23) = 0.0000
      L2(3,23) = 0.0000
      L2(4,23) = 0.0000
      L2(5,23) = 15927.7449
      L2(6,23) = 0.0000
      !
      L2(1,24) = 0.0000
      L2(2,24) = 0.0000
      L2(3,24) = 0.0000
      L2(4,24) = 0.0000
      L2(5,24) = 0.0000
      L2(6,24) = 15927.7449
      !
      L2(1,25) = 22695.5107
      L2(2,25) = 6062.2930
      L2(3,25) = 4688.5279
      L2(4,25) = 0.0000
      L2(5,25) = 0.0000
      L2(6,25) = 0.0000
      !
      L2(1,26) = 0.0000
      L2(2,26) = 15735.6033
      L2(3,26) = 2929.4495
      L2(4,26) = 0.0000
      L2(5,26) = 0.0000
      L2(6,26) = 0.0000
      !
      L2(1,27) = 0.0000
      L2(2,27) = 0.0000
      L2(3,27) = 8435.9186
      L2(4,27) = 0.0000
      L2(5,27) = 74.7933
      L2(6,27) = 0.0000
      !
      L2(1,28) = 0.0000
      L2(2,28) = 0.0000
      L2(3,28) = 0.0000
      L2(4,28) = 4788.1707
      L2(5,28) = 0.0000
      L2(6,28) = 0.0000
      !
      L2(1,29) = 0.0000
      L2(2,29) = 0.0000
      L2(3,29) = 0.0000
      L2(4,29) = 0.0000
      L2(5,29) = 8124.1589
      L2(6,29) = 0.0000
      !
      L2(1,30) = 0.0000
      L2(2,30) = 0.0000
      L2(3,30) = 0.0000
      L2(4,30) = 0.0000
      L2(5,30) = 0.0000
      L2(6,30) = 8124.1589
      !
      L2(1,31) = 5044.4549
      L2(2,31) = 1454.3381
      L2(3,31) = 1480.2522
      L2(4,31) = 0.0000
      L2(5,31) = 0.0000
      L2(6,31) = 0.0000
      !
      L2(1,32) = 0.0000
      L2(2,32) = 3148.2089
      L2(3,32) = 1141.0372
      L2(4,32) = 0.0000
      L2(5,32) = 0.0000
      L2(6,32) = 0.0000
      !
      L2(1,33) = 0.0000
      L2(2,33) = 0.0000
      L2(3,33) = 8663.9433
      L2(4,33) = 0.0000
      L2(5,33) = 12.2695
      L2(6,33) = 0.0000
      !
      L2(1,34) = 0.0000
      L2(2,34) = 0.0000
      L2(3,34) = 0.0000
      L2(4,34) = 3340.1667
      L2(5,34) = 0.0000
      L2(6,34) = 0.0000
      !
      L2(1,35) = 0.0000
      L2(2,35) = 0.0000
      L2(3,35) = 0.0000
      L2(4,35) = 0.0000
      L2(5,35) = 3234.5809
      L2(6,35) = 0.0000
      !
      L2(1,36) = 0.0000
      L2(2,36) = 0.0000
      L2(3,36) = 0.0000
      L2(4,36) = 0.0000
      L2(5,36) = 0.0000
      L2(6,36) = 3234.5809
      !
      L2(1,37) = 1052.1705
      L2(2,37) = 825.6285
      L2(3,37) = 314.4914
      L2(4,37) = 0.0000
      L2(5,37) = 0.0000
      L2(6,37) = 0.0000
      !
      L2(1,38) = 0.0000
      L2(2,38) = 1319.6794
      L2(3,38) = 328.4359
      L2(4,38) = 0.0000
      L2(5,38) = 0.0000
      L2(6,38) = 0.0000
      !
      L2(1,39) = 0.0000
      L2(2,39) = 0.0000
      L2(3,39) = 4428.9280
      L2(4,39) = 0.0000
      L2(5,39) = 8.3260
      L2(6,39) = 0.0000
      !
      L2(1,40) = 0.0000
      L2(2,40) = 0.0000
      L2(3,40) = 0.0000
      L2(4,40) = 695.2534
      L2(5,40) = 0.0000
      L2(6,40) = 0.0000
      !
      L2(1,41) = 0.0000
      L2(2,41) = 0.0000
      L2(3,41) = 0.0000
      L2(4,41) = 0.0000
      L2(5,41) = 550.4506
      L2(6,41) = 0.0000
      !
      L2(1,42) = 0.0000
      L2(2,42) = 0.0000
      L2(3,42) = 0.0000
      L2(4,42) = 0.0000
      L2(5,42) = 0.0000
      L2(6,42) = 550.4506
      !
      L2(1,43) = 0.0000
      L2(2,43) = 203.4452
      L2(3,43) = 54.4998
      L2(4,43) = 0.0000
      L2(5,43) = 0.0000
      L2(6,43) = 0.0000
      !
      L2(1,44) = 0.0000
      L2(2,44) = 101.1702
      L2(3,44) = 89.6482
      L2(4,44) = 0.0000
      L2(5,44) = 0.0000
      L2(6,44) = 0.0000
      !
      L2(1,45) = 0.0000
      L2(2,45) = 0.0000
      L2(3,45) = 0.0000
      L2(4,45) = 0.0000
      L2(5,45) = 0.0000
      L2(6,45) = 0.0000
      !
      L2(1,46) = 0.0000
      L2(2,46) = 0.0000
      L2(3,46) = 0.0000
      L2(4,46) = 58.0813
      L2(5,46) = 0.0000
      L2(6,46) = 0.0000
      !
      L2(1,47) = 0.0000
      L2(2,47) = 0.0000
      L2(3,47) = 0.0000
      L2(4,47) = 0.0000
      L2(5,47) = 76.2316
      L2(6,47) = 0.0000
      !
      L2(1,48) = 0.0000
      L2(2,48) = 0.0000
      L2(3,48) = 0.0000
      L2(4,48) = 0.0000
      L2(5,48) = 0.0000
      L2(6,48) = 76.2316
      !
      L2(1,49) = 0.0000
      L2(2,49) = 40.7639
      L2(3,49) = 17.4505
      L2(4,49) = 0.0000
      L2(5,49) = 0.0000
      L2(6,49) = 0.0000
      !
      L2(1,50) = 0.0000
      L2(2,50) = 0.0000
      L2(3,50) = 0.0000
      L2(4,50) = 0.0000
      L2(5,50) = 0.0000
      L2(6,50) = 0.0000
      !
      L2(1,51) = 0.0000
      L2(2,51) = 0.0000
      L2(3,51) = 0.0000
      L2(4,51) = 0.0000
      L2(5,51) = 0.0000
      L2(6,51) = 0.0000
      !
      L2(1,52) = 0.0000
      L2(2,52) = 0.0000
      L2(3,52) = 0.0000
      L2(4,52) = 0.0000
      L2(5,52) = 0.0000
      L2(6,52) = 0.0000
      !
      L2(1,53) = 0.0000
      L2(2,53) = 0.0000
      L2(3,53) = 0.0000
      L2(4,53) = 0.0000
      L2(5,53) = 0.0000
      L2(6,53) = 0.0000
      !
      L2(1,54) = 0.0000
      L2(2,54) = 0.0000
      L2(3,54) = 0.0000
      L2(4,54) = 0.0000
      L2(5,54) = 0.0000
      L2(6,54) = 0.0000
      !
      L2(1,55) = 0.0000
      L2(2,55) = 7.3807
      L2(3,55) = 0.0000
      L2(4,55) = 0.0000
      L2(5,55) = 0.0000
      L2(6,55) = 0.0000
      !
      L2(1,56) = 0.0000
      L2(2,56) = 0.0000
      L2(3,56) = 8.3358
      L2(4,56) = 0.0000
      L2(5,56) = 0.0000
      L2(6,56) = 0.0000
      !
      L2(1,57) = 0.0000
      L2(2,57) = 0.0000
      L2(3,57) = 0.0000
      L2(4,57) = 0.0000
      L2(5,57) = 0.0000
      L2(6,57) = 0.0000
      !
      L2(1,58) = 0.0000
      L2(2,58) = 0.0000
      L2(3,58) = 0.0000
      L2(4,58) = 0.0000
      L2(5,58) = 0.0000
      L2(6,58) = 0.0000
      !
      L2(1,59) = 0.0000
      L2(2,59) = 0.0000
      L2(3,59) = 0.0000
      L2(4,59) = 0.0000
      L2(5,59) = 0.0000
      L2(6,59) = 0.0000
      !
      L2(1,60) = 0.0000
      L2(2,60) = 0.0000
      L2(3,60) = 0.0000
      L2(4,60) = 0.0000
      L2(5,60) = 0.0000
      L2(6,60) = 0.0000
      !
      L2(1,61) = 4.6481
      L2(2,61) = 4.6044
      L2(3,61) = 5.1734
      L2(4,61) = 0.0000
      L2(5,61) = 0.0000
      L2(6,61) = 0.0000
      !
      L2(1,62) = 0.0000
      L2(2,62) = 3.3580
      L2(3,62) = 7.3662
      L2(4,62) = 0.0000
      L2(5,62) = 0.0000
      L2(6,62) = 0.0000
      !
      L2(1,63) = 0.0000
      L2(2,63) = 0.0000
      L2(3,63) = 7.8253
      L2(4,63) = 0.0000
      L2(5,63) = 0.2880
      L2(6,63) = 0.0000
      !
      L2(1,64) = 0.0000
      L2(2,64) = 0.0000
      L2(3,64) = 0.0000
      L2(4,64) = 3.8769
      L2(5,64) = 0.0000
      L2(6,64) = 0.0000
      !
      L2(1,65) = 0.0000
      L2(2,65) = 0.0000
      L2(3,65) = 0.0000
      L2(4,65) = 0.0000
      L2(5,65) = 4.6751
      L2(6,65) = 0.0000
      !
      L2(1,66) = 0.0000
      L2(2,66) = 0.0000
      L2(3,66) = 0.0000
      L2(4,66) = 0.0000
      L2(5,66) = 0.0000
      L2(6,66) = 4.6751
      !
      L2(1,67) = 0.0355
      L2(2,67) = 0.7002
      L2(3,67) = 0.3320
      L2(4,67) = 0.0000
      L2(5,67) = 0.0000
      L2(6,67) = 0.0000
      !
      L2(1,68) = 0.0000
      L2(2,68) = 0.4465
      L2(3,68) = 0.6232
      L2(4,68) = 0.0000
      L2(5,68) = 0.0000
      L2(6,68) = 0.0000
      !
      L2(1,69) = 0.0000
      L2(2,69) = 0.0000
      L2(3,69) = 1.0983
      L2(4,69) = 0.0000
      L2(5,69) = 0.0432
      L2(6,69) = 0.0000
      !
      L2(1,70) = 0.0000
      L2(2,70) = 0.0000
      L2(3,70) = 0.0000
      L2(4,70) = 0.3126
      L2(5,70) = 0.0000
      L2(6,70) = 0.0000
      !
      L2(1,71) = 0.0000
      L2(2,71) = 0.0000
      L2(3,71) = 0.0000
      L2(4,71) = 0.0000
      L2(5,71) = 0.3729
      L2(6,71) = 0.0000
      !
      L2(1,72) = 0.0000
      L2(2,72) = 0.0000
      L2(3,72) = 0.0000
      L2(4,72) = 0.0000
      L2(5,72) = 0.0000
      L2(6,72) = 0.3729
      !
      L2(1,73) = 0.3925
      L2(2,73) = 0.0000
      L2(3,73) = 0.0065
      L2(4,73) = 0.0000
      L2(5,73) = 0.0000
      L2(6,73) = 0.0000
      !
      L2(1,74) = 0.0000
      L2(2,74) = 0.3401
      L2(3,74) = 0.0000
      L2(4,74) = 0.0000
      L2(5,74) = 0.0000
      L2(6,74) = 0.0000
      !
      L2(1,75) = 0.0000
      L2(2,75) = 0.0000
      L2(3,75) = 0.7840
      L2(4,75) = 0.0000
      L2(5,75) = 0.0046
      L2(6,75) = 0.0000
      !
      L2(1,76) = 0.0000
      L2(2,76) = 0.0000
      L2(3,76) = 0.0000
      L2(4,76) = 0.3591
      L2(5,76) = 0.0000
      L2(6,76) = 0.0000
      !
      L2(1,77) = 0.0000
      L2(2,77) = 0.0000
      L2(3,77) = 0.0000
      L2(4,77) = 0.0000
      L2(5,77) = 0.4571
      L2(6,77) = 0.0000
      !
      L2(1,78) = 0.0000
      L2(2,78) = 0.0000
      L2(3,78) = 0.0000
      L2(4,78) = 0.0000
      L2(5,78) = 0.0000
      L2(6,78) = 0.4571
      !
      L2(1,79) = 0.2834
      L2(2,79) = 0.1820
      L2(3,79) = 0.1040
      L2(4,79) = 0.0000
      L2(5,79) = 0.0000
      L2(6,79) = 0.0000
      !
      L2(1,80) = 0.0000
      L2(2,80) = 0.1859
      L2(3,80) = 0.0480
      L2(4,80) = 0.0000
      L2(5,80) = 0.0000
      L2(6,80) = 0.0000
      !
      L2(1,81) = 0.0000
      L2(2,81) = 0.0000
      L2(3,81) = 0.3796
      L2(4,81) = 0.0000
      L2(5,81) = 0.0031
      L2(6,81) = 0.0000
      !
      L2(1,82) = 0.0000
      L2(2,82) = 0.0000
      L2(3,82) = 0.0000
      L2(4,82) = 0.1669
      L2(5,82) = 0.0000
      L2(6,82) = 0.0000
      !
      L2(1,83) = 0.0000
      L2(2,83) = 0.0000
      L2(3,83) = 0.0000
      L2(4,83) = 0.0000
      L2(5,83) = 0.1475
      L2(6,83) = 0.0000
      !
      L2(1,84) = 0.0000
      L2(2,84) = 0.0000
      L2(3,84) = 0.0000
      L2(4,84) = 0.0000
      L2(5,84) = 0.0000
      L2(6,84) = 0.1475
      !*************************Computation of L1, L2, p_alpha.*L2****************************!
      DO i=1,NTENS
         DO j=1,NTENS
            p_alpha(i,j) = 0
         ENDDO
      ENDDO

      p_alpha = K1*alpha + K2
      DO i=1,NTENS
         DO j=1,NTENS
            L1(i,j) = C_inf(i,j) + C_sum(i,j)*p_alpha(i,j)
         ENDDO
      ENDDO

      DO i_x=1,NTENS
         DO i_y=1,NTENS*PRONY
            L2_alpha(i_x,i_y)=0.0
         ENDDO
      ENDDO

      DO i_x=1,PRONY
         L_B = 1 +NTENS*(i_x-1)
         R_B = 6 +NTENS*(i_x-1)
         LL = L2(1:6,L_B:R_B)
         DO i=1,NTENS
            DO j=1,NTENS
              LL1(i,j) = LL(i,j)*p_alpha(i,j)
            ENDDO
         ENDDO
         L2_alpha(1:NTENS,L_B:R_B)=LL1
      ENDDO

      !	 Compute L2_t
      DO i= 1, NTENS
         DO j= 1, NTENS*PRONY
            L2_t(j,i)=0.0d+0
            L2_alpha_t(j,i)=0.0d+0
         ENDDO
      ENDDO

      DO i= 1, NTENS
         DO j= 1, NTENS*PRONY
            L2_t(j,i)=L2(i,j)
            L2_alpha_t(j,i)=L2_alpha(i,j)
         ENDDO
      ENDDO

      h=DTIME
      !
      !*************************Euler****************************!
      !
      ! W1 COMPUTATION
      !
      DO i= 1,PRONY
         DO j= 1, NTENS
            vector_diag(j+(NTENS*(i-1)))=1/tau(i)
         ENDDO
      ENDDO

      A = 1/aT

      DO i= 1, NTENS*PRONY
         W1_1(i)=1/(1+h*A*vector_diag(i))
      ENDDO

      DO i=1,NTENS*PRONY
         DO j=1,NTENS*PRONY
              W1(i,j)=0.0d0
              W1(i,i)=W1_1(i)
         ENDDO
      ENDDO
      !	 W2 Computation

      DO i= 1, NTENS*PRONY
         DO j= 1, NTENS
            W2(i,j) = -h*W1_1(i)*A*L2_alpha_t(i,j)
         ENDDO
      ENDDO

      ! INTERNAL VARIABLES COMPUTATION (CHI)
      ! Set Chi and Chi_n to zero

      DO i= 1, NTENS*PRONY
         chi(i)=0.0d0
         chi_n(i)=0.0d0
      ENDDO

      ! Statev is Chi(n)
      DO i=1, NTENS*PRONY
         chi_n(i)=statev(i)
      ENDDO
      chi = matmul(W1, chi_n)+ matmul(W2,(stran+dstran))

      ! Jacobian matrix DDSDDE
      DO i=1, NTENS
         DO j=1, NTENS
            DDSDDE(i,j)=0.0d0
         ENDDO
      ENDDO
      DDSDDE=L1+matmul(L2_alpha,W2)
      M2=matmul(L2_alpha,W1)

      ! STRESS COMPUTATION
      stress=matmul(DDSDDE,(stran+dstran))+matmul(M2,chi_n)

      ! UPDATE INTERNAL
      DO i=1, NTENS*PRONY
         STATEV(i)=CHI(i)
      ENDDO

      ENDSUBROUTINE
!																		  !
!																		  !
!						   	 END SUBROUTINE UMAT		     			  !
!																		  !
!*************************************************************************!
